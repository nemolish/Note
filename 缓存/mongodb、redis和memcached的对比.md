### mongodb、redis和memcached的对比

[TOC]

从以下几个维度，对 redis、memcache、mongoDB 做了对比。
#### 1、性能
都比较高，性能对我们来说应该都不是瓶颈。
总体来讲，TPS 方面 redis 和 memcache 差不多，要大于 mongodb。
#### 2、操作的便利性
memcache 数据结构单一，支持简单的数据类型，如bool, string, int等。（key-value）
redis 丰富一些，数据操作方面，redis 更好一些，较少的网络 IO 次数，同时还提供 list，set，hash 等数据结构的存储。
mongodb 支持丰富的数据表达，索引，是文档型的非关系型数据库，支持的查询语言非常丰富，查询功能比较强大，能存储海量数据。
#### 3、内存空间的大小和数据量的大小
redis 在 2.0 版本后支持virtual memory，可以限定内存使用大小，当数据超过阈值，则通过类似LRU的算法把内存中的最不常用数据保存到硬盘的页面文件中，突破物理内存的限制；
可以对 key value 设置过期时间（类似 memcache）memcache 可以修改最大可用内存,采用 LRU 算法。
Memcached 代理软件 magent，比如建立 10 台 4G 的 Memcache 集群，就相当于有了 40G。 magent -s 10.1.2.1 -s 10.1.2.2:11211 -b 10.1.2.3:14000 mongoDB 适合大数据量的存储，依赖操作系统 VM 做内存管理，吃内存也比较厉害，**服务不要和别的服务在一起**。
#### 4、可用性（单点问题）
对于单点问题，
redis，依赖客户端来实现分布式读写；主从复制时，每次从节点重新连接主节点都要依赖整个快照,无增量复制，因性能和效率问题，所以单点问题比较复杂；不支持自动 sharding,需要依赖程序设定一致 hash 机制。
一种替代方案是，不用 redis 本身的复制机制，采用自己做主动复制（多份存储），或者改成增量复制的方式（需要自己实现），一致性问题和性能的权衡。
Memcache 本身没有数据冗余机制，也没必要；对于故障预防，采用依赖成熟的 hash 或者环
状的算法，解决单点故障引起的抖动问题。
mongoDB 支持 master-slave,replicaset（内部采用 paxos 选举算法，自动故障恢复）,auto sharding 机制，对客户端屏蔽了故障转移和切分机制。
#### 5、可靠性（持久化）
对于数据持久化和数据恢复，
redis 支持（快照、AOF）：依赖快照进行持久化，aof 增强了可靠性的同时，对性能有所影
响
memcache 不支持，通常用在做缓存,提升性能；
MongoDB 从 1.8 版本开始采用 binlog 方式支持持久化的可靠性
#### 6、数据一致性（事务支持）
Memcache 在并发场景下，用 cas 保证一致性
redis 事务支持比较弱，只能保证事务中的每个操作连续执行
mongoDB 不支持事务
#### 7、数据分析
mongoDB 内置了数据分析的功能(mapreduce),其他不支持
#### 8、应用场景
redis：数据量较小的更性能操作和运算上
memcache：用于在动态系统中减少数据库负载，提升性能;做缓存，提高性能（适合读多写少，对于数据量比较大，可以采用 sharding）
MongoDB:**主要解决海量数据的访问效率问题**。


表格比较：
||memcache|redis |
|--|--|--|
|类型|内存数据库|内存数据库|
|数据类型|在定义value时就要固定数据类型|不需要有字符串，链表，集 合和有序集合|
|虚拟内存|不支持|支持|
|过期策略 |支持,在 set 时指定过期时间 |支持，通过例如 expire 设定，部分命令可以在set value时指定过期时间|
|分布式| magent|master-slave|
|存储数据安全和灾难恢复 |不支持 |RDB与AOF|